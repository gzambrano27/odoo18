<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- Formato para el reporte -->
    <record id="report_docs_format_solicitud_aprobacion_atenciones_documents" model="report.paperformat">
      <field name="name">Formato Solicitud de Atenciones Comerciales</field>
      <field name="default" eval="True"/>
      <field name="format">A4</field>
      <field name="orientation">Portrait</field>
      <field name="margin_top">7</field>
      <field name="margin_bottom">5</field>
      <field name="margin_left">5</field>
      <field name="margin_right">5</field>
      <field name="header_line" eval="False"/>
      <field name="header_spacing">10</field>
    </record>

    <!-- Report Action -->
    <record id="report_solicitud_aprobacion_atenciones" model="ir.actions.report">
      <field name="name">Solicitud de Atenciones Comerciales</field>
      <field name="model">solicitud.aprobacion.atenciones</field>
      <field name="report_type">qweb-pdf</field>
      <field name="report_name">atenciones_comerciales.report_solicitud_aprobacion_atenciones_document</field>
      <field name="paperformat_id" ref="atenciones_comerciales.report_docs_format_solicitud_aprobacion_atenciones_documents"/>
    </record>

    <!-- Report Template -->
    <template id="report_solicitud_aprobacion_atenciones_document">
      <!-- Se utiliza el layout externo para mantener la cabecera, pie de página, etc. -->
      <t t-call="web.html_container">
        <t t-call="web.basic_layout">
          <!-- El contenido principal se envuelve en <main class="page"> -->
          <main class="page" style="font-family:verdana;">
            <!-- Aseguramos que la variable docs esté definida; si no, se utiliza [doc] -->
            <t t-set="docs" t-value="docs or [doc]"/>
            <!-- Itera sobre los registros que se pasan al reporte -->
            <t t-foreach="docs" t-as="o">

              <!-- ENCABEZADO: Logo de la compañía y Secuencia -->
              <div style="text-align: center; margin-bottom: 20px;">
                <t t-if="o.company_id.logo">
                  <img t-att-src="image_data_uri(o.company_id.logo)" style="max-height:80px;" alt="Logo de la Compañía"/>
                </t>
                <br/>
                <span style="font-size:20px; font-weight: bold;">
                  Número de Solicitud: <t t-esc="o.name"/>
                </span>
              </div>

              <!-- Título del Reporte -->
              <h5 style="text-align: center; margin-bottom: 20px; font-weight: bold;">
                SOLICITUD DE APROBACIÓN - ATENCIONES COMERCIALES
              </h5>

              <!-- Información General -->
              <table class="table table-sm table-bordered" style="margin-bottom: 20px;">
                <thead>
                  <tr>
                    <th colspan="4">Información General</th>
                  </tr>
                </thead>
                <tbody class="text-center">
                  <tr>
                    <td width="17%"><strong>Solicitante:</strong></td>
                    <td class="text-center" width="33%"><span t-field="o.solicitante_id.name"/></td>
                    <td width="17%"><strong>Fecha Solicitud:</strong></td>
                    <td class="text-center" width="33%"><span t-field="o.fecha_solicitud"/></td>
                  </tr>
                  <tr>
                    <td><strong>Cargo:</strong></td>
                    <td class="text-center"><span t-field="o.cargo"/></td>
                    <td><strong>Fecha Salida:</strong></td>
                    <td class="text-center"><span t-field="o.fecha_salida"/></td>
                  </tr>
                  <tr>
                    <td><strong>Área:</strong></td>
                    <td class="text-center"><span t-field="o.area"/></td>
                    <td><strong>Fecha Retorno:</strong></td>
                    <td class="text-center"><span t-field="o.fecha_retorno"/></td>
                  </tr>
                  <tr>
                    <td colspan="2"></td>
                    <td><strong>Días de Viaje:</strong></td>
                    <td class="text-center"><span t-field="o.dias_viaje"/></td>
                  </tr>
                  <tr>
                    <td><strong>Cliente:</strong></td>
                    <td class="text-center"><span t-field="o.cliente_id.name"/></td>
                    <td><strong>Ciudad:</strong></td>
                    <td class="text-center"><span t-field="o.ciudad"/></td>
                  </tr>
                </tbody>
              </table>

              <!-- Delegados -->
              <h5 style="margin-bottom: 10px; font-weight: bold;">Delegados</h5>
              <table class="table table-sm table-bordered" style="margin-bottom: 20px;">
                <thead>
                  <tr>
                    <th style="width:50%; text-align:center;">Nombre</th>
                    <th style="width:50%; text-align:center;">Puesto / Cargo</th>
                  </tr>
                </thead>
                <tbody class="text-center">
                  <t t-foreach="o.delegado_ids" t-as="delegado">
                    <tr>
                      <td style="text-align:center"><span t-field="delegado.name"/></td>
                      <td style="text-align:center"><span t-field="delegado.puesto"/></td>
                    </tr>
                  </t>
                </tbody>
              </table>

              <!-- Gastos de Movilización -->
              <t t-if="o.movilizacion_ids">
                <h5 style="margin-bottom: 10px; font-weight: bold;">Gastos de Movilización</h5>
                <table class="table table-sm table-bordered" style="margin-bottom: 20px;">
                  <thead>
                    <tr>
                      <th style="width:50%; text-align:center;">Concepto</th>
                      <th style="width:25%; text-align:center;">Monto</th>
                      <th style="width:25%; text-align:center;">Observaciones</th>
                    </tr>
                  </thead>
                  <tbody class="text-center">
                    <t t-foreach="o.movilizacion_ids" t-as="mov">
                      <tr>
                        <td style="text-align:center"><span t-field="mov.concepto"/></td>
                        <td style="text-align:center">
                          <span t-field="mov.monto" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                        </td>
                        <td style="text-align:center"><span t-field="mov.observaciones"/></td>
                      </tr>
                    </t>
                  </tbody>
                </table>
              </t>

              <!-- Gastos de Alimentación -->
              <t t-if="o.alimentacion_ids">
                <h5 style="margin-bottom: 10px; font-weight: bold;">Gastos de Alimentación</h5>
                <table class="table table-sm table-bordered" style="margin-bottom: 20px;">
                  <thead>
                    <tr>
                      <th style="width:50%; text-align:center;">Concepto</th>
                      <th style="width:25%; text-align:center;">Monto</th>
                      <th style="width:25%; text-align:center;">Observaciones</th>
                    </tr>
                  </thead>
                  <tbody class="text-center">
                    <t t-foreach="o.alimentacion_ids" t-as="al">
                      <tr>
                        <td style="text-align:center"><span t-field="al.concepto"/></td>
                        <td style="text-align:center">
                          <span t-field="al.monto" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                        </td>
                        <td style="text-align:center"><span t-field="al.observaciones"/></td>
                      </tr>
                    </t>
                  </tbody>
                </table>
              </t>

              <!-- Totales: Ahora alineado a la derecha -->
              <hr style="margin: 20px 0;"/>
              <h5 style="margin-bottom: 10px; text-align:right; font-weight: bold;">Totales</h5>
              <table class="table table-condensed" style="width: 50%; margin-left: auto; margin-right: 0;">
                <tr class="text-center">
                  <td width="80%"><strong>Total Movilización:</strong></td>
                  <td style="text-align:right" width="20%">
                    <span t-field="o.total_movilizacion" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                  </td>
                </tr>
                <tr class="text-center">
                  <td><strong>Total Alimentación:</strong></td>
                  <td style="text-align:right">
                    <span t-field="o.total_alimentacion" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                  </td>
                </tr>
                <tr class="text-center">
                  <td><strong>Total Solicitud:</strong></td>
                  <td style="text-align:right">
                    <span t-field="o.total_solicitud" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                  </td>
                </tr>
              </table>
            </t>
            <!-- Bloque para el caso en que no exista "docs": -->
            <t t-if="not docs">
              <t t-set="o" t-value="doc"/>
              <h2 style="text-align: center; margin-bottom: 20px;">
                Solicitud de Atenciones Comerciales
              </h2>
              <!-- Se recomienda copiar el mismo bloque de contenido para mantener el mismo diseño -->
            </t>
          </main>
        </t>
      </t>
    </template>
  </data>
</odoo>
