<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- 🧾 Vista formulario del Wizard -->
        <record id="electronic_document_received_workflow_wizard_view_form" model="ir.ui.view">
            <field name="name">electronic.document.received.workflow.wizard.form</field>
            <field name="model">electronic.document.received.workflow.wizard</field>
            <field name="arch" type="xml">
                <form string="Documentos Recibidos" version="18.0">
                    <sheet>
                        <group>
                            <!-- Campos ocultos -->
                            <field name="state" invisible="1"/>
                            <field name="confirmed_state" invisible="1"/>
                            <field name="document_code" invisible="1"/>

                            <!-- Compañía -->
                            <field name="company_id"
                                   readonly="1"
                                   force_save="1"
                                   options="{'no_create': True, 'no_edit': True, 'no_open': True}"/>

                            <!-- Tipo de factura -->
                            <field name="invoice_type"
                                   invisible="document_code == '07' or not context.get('only_update', False)"/>

                            <!-- Servicio -->
                            <field name="service_id"
                                   options="{'no_create': True, 'no_edit': True, 'no_open': True}"
                                   domain="[('type','=','service'),'|',('company_id','=',False),('company_id','=',company_id)]"
                                   invisible="document_code == '07' or invoice_type != 'service' or not context.get('only_update', False)"
                                   required="invoice_type == 'service'"/>

                            <!-- Orden de compra -->
                            <field name="order_id"
                                   domain="[('partner_id','=',partner_id),('state','=','purchase')]"
                                   invisible="document_code != '01' or invoice_type == 'service' or not context.get('only_update', False)"/>

                            <field name="partner_id" invisible="1"/>

                            <!-- Comentarios -->
                            <field name="comments"
                                   placeholder="COMENTARIOS..."
                                   on_change="onchange_upper(comments,'comments')"
                                   required="state in ('confirmed','annulled','draft','closed') or confirmed_state in ('verified','rejected')"/>
                        </group>
                    </sheet>

                    <footer>
                        <button name="process" type="object" string="Procesar" class="btn-primary" icon="fa-cogs"/>
                        <button special="cancel" string="Salir" class="btn-secondary" icon="fa-times"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- ⚙️ Acción: Anular -->
        <record id="electronic_document_received_workflow_wizard_view_annulled_action" model="ir.actions.act_window">
            <field name="name">Anular</field>
            <field name="res_model">electronic.document.received.workflow.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="electronic_document_received_workflow_wizard_view_form"/>
            <field name="context">{'default_state': 'annulled', 'update_table': False, 'pass_validate': True, 'only_update': False}</field>
            <field name="target">new</field>
        </record>

        <!-- ⚙️ Acción: Recepción Rechazar -->
        <record id="electronic_document_received_workflow_wizard_view_2rejected_action" model="ir.actions.act_window">
            <field name="name">Recepción: Rechazar</field>
            <field name="res_model">electronic.document.received.workflow.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="electronic_document_received_workflow_wizard_view_form"/>
            <field name="context">{'update_table': False, 'pass_validate': True, 'default_confirmed_state': 'rejected', 'only_update': False}</field>
            <field name="target">new</field>
        </record>

        <!-- ⚙️ Acción: Recepción Verificar -->
        <record id="electronic_document_received_workflow_wizard_view_2verified_action" model="ir.actions.act_window">
            <field name="name">Recepción: Verificar</field>
            <field name="res_model">electronic.document.received.workflow.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="electronic_document_received_workflow_wizard_view_form"/>
            <field name="context">{'update_table': False, 'pass_validate': True, 'default_confirmed_state': 'verified', 'only_update': False}</field>
            <field name="target">new</field>
        </record>

        <!-- ⚙️ Acción: Actualizar -->
        <record id="electronic_document_received_workflow_wizard_view_update_action" model="ir.actions.act_window">
            <field name="name">Actualizar</field>
            <field name="res_model">electronic.document.received.workflow.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="electronic_document_received_workflow_wizard_view_form"/>
            <field name="context">{'only_update': True, 'update_table': False, 'pass_validate': True}</field>
            <field name="target">new</field>
        </record>

    </data>
</odoo>
