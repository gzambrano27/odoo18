<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data noupdate="0">

    <!-- Categoría -->
    <record id="module_category_sse" model="ir.module.category">
      <field name="name">Solicitud de Salida de Equipos</field>
      <field name="sequence">80</field>
    </record>

    <!-- Grupos -->
    <record id="group_sse_usuario" model="res.groups">
      <field name="name">Solicitud de Salida de Equipos – Usuario</field>
      <field name="category_id" ref="sde_document.module_category_sse"/>
    </record>

    <record id="group_sse_admin" model="res.groups">
      <field name="name">Solicitud de Salida de Equipos – Administrador</field>
      <field name="implied_ids" eval="[(4, ref('sde_document.group_sse_usuario'))]"/>
      <field name="category_id" ref="sde_document.module_category_sse"/>
    </record>

    <record id="group_sse_manager" model="res.groups">
      <field name="name">Solicitud de Salida de Equipos – Jefe</field>
      <field name="implied_ids" eval="[(4, ref('sde_document.group_sse_usuario'))]"/>
      <field name="category_id" ref="sde_document.module_category_sse"/>
    </record>

    <!-- ===== Reglas sse.document ===== -->

    <!-- Admin ve todo -->
    <record id="rule_sse_document_admin_all" model="ir.rule">
      <field name="name">SSE Document - Admin ver todo</field>
      <field name="model_id" ref="sde_document.model_sse_document"/>
      <field name="domain_force"><![CDATA[
        [(1,'=',1)]
      ]]></field>
      <field name="groups" eval="[(4, ref('sde_document.group_sse_admin'))]"/>
    </record>

    <!-- Usuario: propios y dentro de sus compañías -->
    <record id="rule_sse_document_user_own" model="ir.rule">
      <field name="name">SSE Document - Usuario ve lo propio</field>
      <field name="model_id" ref="sde_document.model_sse_document"/>
      <field name="domain_force"><![CDATA[
        ['&',
          '|', ('company_id','=',False), ('company_id','in', user.company_ids.ids),
          '|', ('create_uid','=', user.id), ('employee_id.user_id','=', user.id)
        ]
      ]]></field>
      <field name="groups" eval="[(4, ref('sde_document.group_sse_usuario'))]"/>
    </record>

    <!-- Jefe: lo propio + donde es jefe directo (y por compañías) -->
    <record id="rule_sse_document_manager_scope" model="ir.rule">
      <field name="name">SSE Document - Jefe ve asignados</field>
      <field name="model_id" ref="sde_document.model_sse_document"/>
      <field name="domain_force"><![CDATA[
        ['&',
          '|', ('company_id','=',False), ('company_id','in', user.company_ids.ids),
          '|','|',
            ('manager_id.user_id','=', user.id),
            ('create_uid','=', user.id),
            ('employee_id.user_id','=', user.id)
        ]
      ]]></field>
      <field name="groups" eval="[(4, ref('sde_document.group_sse_manager'))]"/>
    </record>

    <!-- ===== Reglas sse.equipment.line ===== -->

    <!-- Admin ve todo -->
    <record id="rule_sse_line_admin_all" model="ir.rule">
      <field name="name">SSE Line - Admin ver todo</field>
      <field name="model_id" ref="sde_document.model_sse_equipment_line"/>
      <field name="domain_force"><![CDATA[
        [(1,'=',1)]
      ]]></field>
      <field name="groups" eval="[(4, ref('sde_document.group_sse_admin'))]"/>
    </record>

    <!-- Usuario: líneas de sus documentos (por compañías) -->
    <record id="rule_sse_line_user_own" model="ir.rule">
      <field name="name">SSE Line - Usuario ve lo propio</field>
      <field name="model_id" ref="sde_document.model_sse_equipment_line"/>
      <field name="domain_force"><![CDATA[
        ['&',
          '|', ('document_id.company_id','=',False), ('document_id.company_id','in', user.company_ids.ids),
          '|', ('document_id.create_uid','=', user.id),
               ('document_id.employee_id.user_id','=', user.id)
        ]
      ]]></field>
      <field name="groups" eval="[(4, ref('sde_document.group_sse_usuario'))]"/>
    </record>

    <!-- Jefe: además las líneas donde es jefe directo -->
    <record id="rule_sse_line_manager_scope" model="ir.rule">
      <field name="name">SSE Line - Jefe ve asignados</field>
      <field name="model_id" ref="sde_document.model_sse_equipment_line"/>
      <field name="domain_force"><![CDATA[
        ['&',
          '|', ('document_id.company_id','=',False), ('document_id.company_id','in', user.company_ids.ids),
          '|','|',
            ('document_id.manager_id.user_id','=', user.id),
            ('document_id.create_uid','=', user.id),
            ('document_id.employee_id.user_id','=', user.id)
        ]
      ]]></field>
      <field name="groups" eval="[(4, ref('sde_document.group_sse_manager'))]"/>
    </record>

    <!-- Lectura de sse.location para todos los grupos SSE -->
    <record id="rule_sse_location_user_read" model="ir.rule">
      <field name="name">SSE Location - leer</field>
      <field name="model_id" ref="sde_document.model_sse_location"/>
      <field name="domain_force"><![CDATA[
        [(1,'=',1)]
      ]]></field>
      <field name="groups" eval="[
        (4, ref('sde_document.group_sse_usuario')),
        (4, ref('sde_document.group_sse_manager')),
        (4, ref('sde_document.group_sse_admin'))
      ]"/>
    </record>

  </data>
</odoo>
