<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- =============================
             🔹 LIST VIEW
        ============================== -->
        <record id="view_ticket_gps_list" model="ir.ui.view">
            <field name="name">ticket.gps.list</field>
            <field name="model">ticket.gps</field>
            <field name="arch" type="xml">
                <list string="Tickets GPS"
                      decoration-success="color_state == 'creator'"
                      decoration-info="color_state == 'assigned'"
                      decoration-warning="color_state == 'cc'"
                      decoration-danger="color_state == 'delegado'">
                    <field name="color_state" column_invisible="1"/>
                    <field name="name"/>
                    <field name="creation_date"/>
                    <field name="asunto"/>
                    <field name="encargado" string="Encargado"/>
                    <field name="state" widget="badge"
                           decoration-info="state == 'sent'"
                           decoration-muted="state == 'draft'"
                           decoration-warning="state == 'progress'"
                           decoration-success="state == 'done'"/>
                </list>
            </field>
        </record>

        <!-- =============================
             🔹 FORM VIEW
        ============================== -->
        <record id="view_ticket_gps_form" model="ir.ui.view">
            <field name="name">ticket.gps.form</field>
            <field name="model">ticket.gps</field>
            <field name="arch" type="xml">
                <form string="Ticket GPS">
                    <header>
                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,sent,progress,done"
                               statusbar_fold="done"/>

                        <!-- Botones -->
                        <button name="action_send" type="object" string="Enviar"
                                invisible="not (show_send_button and state == 'draft')"/>

                        <button name="action_draft" type="object" string="Volver a Borrador"
                                invisible="not (show_return_draft_button and state == 'sent')"/>

                        <button name="action_progress" type="object" string="En Proceso"
                                invisible="not (show_assigned_buttons and state == 'sent')"/>

                        <button name="action_done" type="object" string="Finalizado"
                                invisible="not (show_assigned_buttons and state == 'progress')"/>

                        <button name="action_notify_delegado" type="object" string="Notificar Delegado"
                                invisible="not (is_encargado_user and delegar_personal and state in ('progress','done'))"/>

                        <button name="action_notify_final_cc" type="object" string="Notificar CC"
                                invisible="state != 'done'"/>

                        <button name="action_notify_final_encargado" type="object" string="Notificar Encargado"
                                invisible="state != 'done'"/>
                    </header>

                    <sheet>
                        <group col="12">
                            <group colspan="6">
                                <field name="name" readonly="1"/>
                                <field name="creation_date" readonly="1"/>
                                <field name="asunto" readonly="state != 'draft'"/>
                            </group>
                            <group colspan="6">
                                <field name="creator_id" readonly="1"/>
                                <field name="sending_user_id" invisible="1"/>
                            </group>
                        </group>

                        <group col="12">
                            <group colspan="12">
                                <field name="date_sent" invisible="1"/>
                                <field name="date_progress" invisible="1"/>
                                <field name="date_done" invisible="1"/>
                            </group>
                        </group>

                        <!-- Encargado / CC -->
                        <group col="12">
                            <group colspan="6">
                                <field name="encargado" readonly="state != 'draft'"/>
                                <field name="department_id" readonly="1"/>
                                <field name="company_id" readonly="1"/>
                            </group>
                            <group colspan="6">
                                <field name="user_name" readonly="1"/>
                                <field name="email" readonly="1"/>
                                <field name="phone" readonly="1"/>
                                <field name="cc" widget="many2many_tags"
                                       readonly="state != 'draft'"/>
                            </group>
                        </group>

                        <!-- Descripción -->
                        <group col="12">
                            <field name="description" widget="html"
                                   readonly="state != 'draft'"/>
                        </group>

                        <!-- Delegación / Resultado -->
                        <group col="12" invisible="not (state in ('progress','done'))">
                            <field name="delegar_personal" readonly="state == 'done'"/>
                            <field name="delegacion_a"
                                   invisible="not delegar_personal"
                                   readonly="state == 'done'"/>
                            <field name="resultado" widget="html" force_save="1"
                                   invisible="state != 'done'"
                                   readonly="resultado_readonly"/>
                        </group>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- =============================
             🔹 SEARCH VIEW (corregido)
        ============================== -->
        <record id="view_ticket_gps_search" model="ir.ui.view">
            <field name="name">ticket.gps.search</field>
            <field name="model">ticket.gps</field>
            <field name="arch" type="xml">
                <search string="Buscar Tickets">
                    <field name="name" string="Código"/>
                    <field name="creation_date" string="Fecha de creación"/>
                    <field name="asunto" string="Asunto"/>
                    <field name="encargado" string="Encargado"/>
                    <field name="state" string="Estado"/>

                    <filter name="my_tickets" string="Mis Tickets" domain="[('creator_id', '=', uid)]"/>
                    <filter name="asignados_a_mi" string="Tickets asignados a mí" domain="[('encargado.user_id', '=', uid)]"/>
                    <filter name="delegados_a_mi" string="Tickets delegados a mí" domain="[('delegacion_a.user_id', '=', uid)]"/>
                    <filter name="my_cc_tickets" string="Tickets con copia a mí" domain="[('cc.user_id', '=', uid)]"/>
                </search>
            </field>
        </record>

        <!-- =============================
             🔹 MENÚ Y ACCIÓN
        ============================== -->
        <record id="action_ticket_gps" model="ir.actions.act_window">
            <field name="name">Tickets GPS</field>
            <field name="res_model">ticket.gps</field>
            <field name="view_mode">list,form,search</field>
            <field name="context">{'search_default_my_tickets':1}</field>
        </record>

        <menuitem id="menu_ticket_gps_root"
                  name="Tickets GPS"
                  web_icon="ticketera_gps,static/description/icono.png"/>

        <menuitem id="menu_ticket_gps"
                  parent="menu_ticket_gps_root"
                  name="Tickets"
                  action="action_ticket_gps"/>

    </data>
</odoo>
