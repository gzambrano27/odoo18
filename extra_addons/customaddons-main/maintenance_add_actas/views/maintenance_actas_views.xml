<odoo>
    <record id="action_maintenance_actas" model="ir.actions.act_window">
        <field name="name">Actas</field>
        <field name="res_model">maintenance.acta</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crea y administra tus actas de entrega y recepción aquí.
            </p>
        </field>
    </record>

    <!-- Vista formulario de Actas -->
    <record id="view_form_maintenance_acta" model="ir.ui.view">
        <field name="name">maintenance.acta.form</field>
        <field name="model">maintenance.acta</field>
        <field name="arch" type="xml">
            <form string="Acta">
                <header>
                    <button name="action_set_draft" type="object" string="Marcar como borrador"
                            invisible="not state in ('open','closed','damaged')"
                            class="btn-primary"/>
                    <button name="action_open" type="object" string="Marcar abierto"
                            invisible="tipo != 'entrega' or state != 'draft'"/>
                    <button name="action_close" type="object" string="Marcar cerrado"
                            invisible="not state in ('draft','open')"/>
                    <button name="action_damage" type="object" string="Marcar dañado"
                            invisible="tipo != 'recepcion' or state != 'draft'"/>
                    <!-- ✅ Botones de impresión dinámicos -->
                    <button name="print_acta_entrega" string="Imprimir Acta de Entrega"
                            type="object" class="btn-secondary"
                            invisible="tipo != 'entrega'"/>
                    <button name="print_acta_recepcion" string="Imprimir Acta de Recepción"
                            type="object" class="btn-secondary"
                            invisible="tipo != 'recepcion'"/>
                </header>
                <sheet>
                    <group>
                        <field name="codigo" readonly="1" string="Código de Acta"/>
                        <field name="tipo" widget="radio" required="1"
                               readonly="state in ('open','closed','damaged')"/>
                        <field name="fecha" required="1"/>
                        <field name="equipo_recibe" required="1"/>
                    </group>
                    <group invisible="tipo == 'recepcion'">
                        <field name="empleado_recibe" required="True"/>
                        <field name="persona_entrega" required="True"/>
                        <field name="observacion" required="True"/>
                        <field name="ubicacion" required="True"/>
                    </group>
                    <group invisible="tipo == 'entrega'">
                        <field name="persona_entrega" required="True"/>
                        <field name="empleado_recibe" required="True"/>
                        <field name="observacion" required="True"/>
                        <field name="ubicacion" required="True"/>
                    </group>
                </sheet>
                <chatter>
                    <field name="message_follower_ids" groups="base.group_user"
                           options="{'post_refresh': 'recipients'}"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </chatter>
            </form>
        </field>
    </record>

    <!-- Vista lista de Actas -->
    <record id="view_tree_maintenance_acta" model="ir.ui.view">
        <field name="name">maintenance.acta.list</field>
        <field name="model">maintenance.acta</field>
        <field name="arch" type="xml">
            <list string="Actas">
                <field name="codigo" string="Código de Acta"/>
                <field name="tipo" optional="show"/>
                <field name="fecha"/>
                <field name="empleado_recibe"/>
                <field name="persona_entrega"/>
                <field name="equipo_recibe"/>
                <field name="state" widget="badge" string="Estado" optional="show"
                       decoration-muted="state == 'draft'"
                       decoration-success="state == 'open'"
                       decoration-warning="state == 'closed'"
                       decoration-danger="state == 'damaged'"/>
            </list>
        </field>
    </record>

    <!-- ✅ Vista búsqueda con agrupaciones -->
    <record id="view_search_maintenance_acta" model="ir.ui.view">
        <field name="name">maintenance.acta.search</field>
        <field name="model">maintenance.acta</field>
        <field name="arch" type="xml">
            <search string="Buscar Actas">
                <field name="codigo"/>
                <field name="fecha"/>
                <field name="tipo"/>
                <field name="empleado_recibe"/>
                <field name="persona_entrega"/>

                <!-- Agrupaciones -->
                <group expand="0" string="Agrupar por">
                    <filter string="Tipo de Acta"
                            name="group_tipo"
                            context="{'group_by':'tipo'}"/>
                    <filter string="Usuario que Recibe"
                            name="group_empleado_recibe"
                            context="{'group_by':'empleado_recibe'}"/>
                    <filter string="Usuario que Entrega"
                            name="group_persona_entrega"
                            context="{'group_by':'persona_entrega'}"/>
                    <filter string="Estado"
                            name="group_state"
                            context="{'group_by':'state'}"/>
                </group>

                <!-- Filtros de estado rápidos -->
                <separator/>
                <filter string="Borradores" name="filter_draft" domain="[('state','=','draft')]"/>
                <filter string="Abiertos" name="filter_open" domain="[('state','=','open')]"/>
                <filter string="Cerrados" name="filter_closed" domain="[('state','=','closed')]"/>
                <filter string="Dañados" name="filter_damaged" domain="[('state','=','damaged')]"/>
            </search>
        </field>
    </record>

</odoo>
